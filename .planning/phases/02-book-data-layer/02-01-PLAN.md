---
phase: 02-book-data-layer
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - gradle/libs.versions.toml
  - shared/build.gradle.kts
  - shared/src/commonMain/kotlin/com/browsy/data/model/Book.kt
  - shared/src/commonMain/kotlin/com/browsy/data/model/BookCover.kt
autonomous: true
---

<objective>
Set up Ktor HTTP client, kotlinx.serialization dependencies, and create core data models for books.

Purpose: Foundation for book API integration - establishes HTTP client, JSON serialization, and shared data structures
Output: Configured dependencies and Book domain models ready for API implementations
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-book-data-layer/DISCOVERY.md

# Phase 1 foundation provides:
@.planning/phases/01-foundation/01-01-SUMMARY.md

# Existing build configuration:
@gradle/libs.versions.toml
@shared/build.gradle.kts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Ktor and kotlinx.serialization dependencies</name>
  <files>gradle/libs.versions.toml, shared/build.gradle.kts</files>
  <action>
Add to libs.versions.toml:
- ktor version: 2.3.7
- kotlinx-serialization version: 1.6.2

Add libraries:
- ktor-client-core
- ktor-client-content-negotiation
- ktor-serialization-kotlinx-json
- ktor-client-okhttp (Android engine)
- ktor-client-darwin (iOS engine)
- kotlinx-serialization-json

In shared/build.gradle.kts:
- Add kotlinx serialization plugin to plugins block: `kotlin("plugin.serialization") version "2.0.0"`
- Add ktor-client-core, ktor-client-content-negotiation, ktor-serialization-kotlinx-json, kotlinx-serialization-json to commonMain dependencies
- Add ktor-client-okhttp to androidMain dependencies
- Add ktor-client-darwin to iosMain dependencies

Use version catalog references (libs.ktor.client.core, etc.) for all dependencies.
  </action>
  <verify>./gradlew :shared:dependencies shows Ktor and serialization libraries in all source sets</verify>
  <done>Ktor HTTP client and kotlinx.serialization configured for all platforms</done>
</task>

<task type="auto">
  <name>Task 2: Create Book domain model</name>
  <files>shared/src/commonMain/kotlin/com/browsy/data/model/Book.kt</files>
  <action>
Create Book data class in com.browsy.data.model package with @Serializable annotation:

Fields:
- id: String (unique identifier, can be ISBN or API-specific ID)
- title: String
- author: String (for MVP, single author string; expand to List later)
- coverUrl: String? (nullable - not all books have covers)
- description: String? (nullable - may be missing)
- publishedDate: String? (nullable, ISO format YYYY-MM-DD when available)
- pageCount: Int? (nullable)
- isbn: String? (nullable - ISBN-13 preferred, fallback to ISBN-10)
- subjects: List&lt;String&gt; (empty list if none, used for genre/vibe tagging later)

Add KDoc comment explaining this is the core book model used throughout the app, mapped from API responses.

Use kotlinx.serialization annotations (@Serializable, @SerialName if needed).
  </action>
  <verify>./gradlew :shared:build compiles without errors, Book.kt is serializable</verify>
  <done>Book model defined with all required fields, ready for API response mapping</done>
</task>

<task type="auto">
  <name>Task 3: Create BookCover utility model</name>
  <files>shared/src/commonMain/kotlin/com/browsy/data/model/BookCover.kt</files>
  <action>
Create BookCover data class for managing cover image URLs at different sizes:

Fields:
- small: String? (thumbnail)
- medium: String? (list/grid view)
- large: String? (full-screen display)

Include a companion object with:
- fun fromUrl(url: String): BookCover - creates BookCover with all sizes pointing to same URL
- val EMPTY: BookCover - represents missing cover (all nulls)

Add KDoc explaining this separates cover image concerns from Book model, allowing API-specific size handling.

This is NOT @Serializable - it's a utility for consuming APIs, not storing data.
  </action>
  <verify>./gradlew :shared:build compiles, BookCover helper methods work</verify>
  <done>BookCover model provides structured access to cover images at multiple sizes</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] ./gradlew :shared:build succeeds without errors or warnings
- [ ] Ktor client and serialization dependencies present in all source sets
- [ ] Book and BookCover models compile and are ready for use
- [ ] No breaking changes to existing code from Phase 1
</verification>

<success_criteria>
- All tasks completed
- Dependencies properly configured in version catalog
- Book domain model is serializable and well-documented
- BookCover utility model provides multi-size image handling
- Gradle build passes for shared module
- Foundation ready for API client implementation
</success_criteria>

<output>
After completion, create `.planning/phases/02-book-data-layer/02-01-SUMMARY.md`
</output>
