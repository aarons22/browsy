---
phase: 03-core-ui-main-feed
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [iosApp/iosApp/BookFeedView.swift, iosApp/iosApp/iOSApp.swift, iosApp/iosApp/ContentView.swift]
autonomous: true
---

<objective>
Implement iOS book feed with full-screen vertical paging, high-quality cover display, and infinite scroll.

Purpose: Deliver the core browsing experience for iOS using native SwiftUI vertical paging patterns. Priority #1 is visual quality - covers must be crisp and beautiful. Snap-to-position and smooth transitions follow.

Output: Working iOS book feed with TikTok-style vertical swipe, snap behavior, and seamless pagination.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-core-ui-main-feed/03-CONTEXT.md
@.planning/phases/03-core-ui-main-feed/03-RESEARCH.md
@shared/src/commonMain/kotlin/com/browsy/data/model/Book.kt
@shared/src/commonMain/kotlin/com/browsy/data/repository/BookRepository.kt
@iosApp/iosApp/iOSApp.swift
@iosApp/iosApp/ContentView.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BookFeedView with iOS 16 compatible vertical paging</name>
  <files>iosApp/iosApp/BookFeedView.swift</files>
  <action>
Create BookFeedView using TabView with PageTabViewStyle for iOS 16 compatibility (project targets iOS 16.0).

**Implementation:**
- Use `TabView` with `.tabViewStyle(.page)` for vertical paging (iOS 16 compatible)
- Set `.indexViewStyle(.page(backgroundDisplayMode: .never))` to hide page indicators
- Use LazyVStack with full-screen book cover views
- Each cover fills screen using `.frame(maxWidth: .infinity, maxHeight: .infinity)`
- Load 20 books initially from BookRepository.create() search for "fantasy" (hardcoded for MVP)
- Display covers using AsyncImage with `.contentFit(.fill)` to preserve quality (RESEARCH.md: quality over performance)
- Show title + author as small overlay text at bottom
- Add simple heart icon button overlay for TBR action (non-functional for now - Phase 4 will implement)

**Pagination strategy (from RESEARCH.md):**
- Track currentIndex with @State
- When user reaches book at index (books.count - 5), trigger loadMoreBooks()
- loadMoreBooks() appends next 20 books to array
- Use .onAppear on each book view to detect when it appears

**Quality priority (from CONTEXT.md):**
- AsyncImage with no size constraints = original quality preserved
- Use .aspectRatio(contentMode: .fill) to maintain aspect without distortion
- No custom downsampling - let AsyncImage handle quality

**Why TabView not ScrollView:**
Project targets iOS 16.0, but scrollTargetBehavior(.paging) requires iOS 17+. TabView + PageTabViewStyle works on iOS 16 and provides snap-to-position behavior. If user wants iOS 17+ features later, we can refactor to ScrollView + scrollTargetBehavior.

**Avoid:**
- GeometryReader for sizing (use frame modifiers instead - simpler for TabView)
- Custom gesture recognizers (TabView handles swipe gestures)
- Manual snap calculations (TabView snaps automatically)
  </action>
  <verify>
Open Xcode, build iosApp target, run in simulator. Verify:
- App shows full-screen book covers
- Vertical swipe changes books with snap behavior
- Covers are crisp and fill screen
- Title/author visible as overlay
- Heart icon visible (non-functional OK)
  </verify>
  <done>
- BookFeedView.swift exists with TabView vertical paging
- 20 books loaded initially from BookRepository
- Pagination triggers at 5 books from end
- AsyncImage displays high-quality covers
- Title/author overlay present
- TBR button visible (implementation in Phase 4)
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate BookFeedView into iOS app root</name>
  <files>iosApp/iosApp/iOSApp.swift</files>
  <action>
Update iOSApp.swift to show BookFeedView as root view instead of ContentView.

**Implementation:**
- Import shared module to access BookRepository
- In WindowGroup body, replace ContentView() with BookFeedView()
- Keep ContentView.swift for future use (profile screen, settings, etc.)

**Simple integration:**
```swift
@main
struct iOSApp: App {
    var body: some Scene {
        WindowGroup {
            BookFeedView()
        }
    }
}
```

No complex navigation yet - Phase 4 will add tab bar and navigation structure.
  </action>
  <verify>
Build and run in Xcode simulator. App opens directly to book feed, no "Hello World" text.
  </verify>
  <done>
- iOSApp.swift uses BookFeedView as root
- App launches directly into book browsing experience
- No navigation chrome yet (intentional - Phase 4)
  </done>
</task>

<task type="auto">
  <name>Task 3: Add FeedViewModel to manage book state and pagination</name>
  <files>iosApp/iosApp/FeedViewModel.swift</files>
  <action>
Create FeedViewModel as ObservableObject to handle book loading and pagination logic.

**Implementation:**
- @Published var books: [Book] = []
- @Published var isLoading: Bool = false
- private let repository: BookRepository
- private var currentPage = 0
- private let pageSize = 20

**Methods:**
- `init()` - Creates repository with BookRepository.create(apiKey: "YOUR_API_KEY_HERE")
- `loadInitialBooks()` async - Loads first page, sets books
- `loadMoreBooks()` async - Loads next page, appends to books
- `shouldLoadMore(currentIndex: Int) -> Bool` - Returns true if currentIndex >= books.count - 5

**Error handling:**
- Wrap repository calls in do-catch
- On error, print to console (proper error UI in Phase 4)
- Set isLoading = false in finally block

**Usage in BookFeedView:**
- @StateObject var viewModel = FeedViewModel()
- Call viewModel.loadInitialBooks() in .task modifier
- Call viewModel.shouldLoadMore(index) in each book's .onAppear
- If shouldLoadMore returns true, call viewModel.loadMoreBooks()

**Note on API key:**
Google Books API key will be hardcoded for now (user needs to provide their own). Phase 5 will add proper secrets management.
  </action>
  <verify>
Build succeeds. Run in simulator, observe console logs for book loading. Scroll through ~15 books, verify more load automatically.
  </verify>
  <done>
- FeedViewModel.swift exists with pagination logic
- ViewModel integrated into BookFeedView
- Initial 20 books load on launch
- Pagination triggers at 5 books from end
- Books append to feed seamlessly
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Xcode build succeeds with no errors
- [ ] iOS simulator runs without crashes
- [ ] Book covers display full-screen and crisp
- [ ] Vertical swipe changes books with snap behavior
- [ ] Pagination loads more books automatically
- [ ] Title/author overlay visible
- [ ] TBR button visible (non-functional OK)
</verification>

<success_criteria>
- All tasks completed
- iOS app shows vertical book feed on launch
- Covers are high-quality and full-screen
- Snap-to-position works (TabView default behavior)
- Infinite scroll pagination working
- No build errors or runtime crashes
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-ui-main-feed/03-01-SUMMARY.md`
</output>
