---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified: [iosApp/iosApp/ContentView.swift, iosApp/iosApp/iOSApp.swift, iosApp/iosApp.xcodeproj/project.pbxproj, iosApp/iosApp/Assets.xcassets]
autonomous: true
---

<objective>
Create iOS app shell with SwiftUI that consumes the shared Kotlin module.

Purpose: Establish the iOS native UI foundation using SwiftUI, demonstrating successful integration with the KMP shared framework. This proves the cross-platform architecture works end-to-end.

Output: Working iOS app that displays the greeting from the shared Kotlin module, confirming KMP-SwiftUI integration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Xcode project for iOS app</name>
  <files>iosApp/iosApp.xcodeproj/project.pbxproj, iosApp/iosApp/Info.plist</files>
  <action>
Create iOS Xcode project structure:

1. Create iosApp directory with standard Xcode project layout
2. Use xcodebuild or manual project creation with:
   - Product name: iosApp
   - Bundle identifier: com.browsy.ios
   - Deployment target: iOS 16.0
   - Swift Language Version: 5.9

3. Configure the project to:
   - Link the shared framework (from ../shared/build/XCFrameworks/debug/shared.xcframework)
   - Set Framework Search Paths to find the KMP-generated framework
   - Add a Run Script build phase to run Gradle embedAndSignAppleFrameworkForXcode

4. Alternative approach if manual Xcode project is complex:
   - Create iosApp.xcodeproj using a minimal template
   - The KMP Gradle plugin can generate the Xcode project configuration
   - Ensure iosApp target is properly configured for shared framework embedding

Note: KMP projects typically configure this via Gradle's XCFramework tasks. Check if shared/build.gradle.kts properly exposes the framework.
  </action>
  <verify>Xcode project opens without errors and shows iosApp target</verify>
  <done>Xcode project created with proper framework linkage configuration</done>
</task>

<task type="auto">
  <name>Task 2: Create SwiftUI app entry point and ContentView</name>
  <files>iosApp/iosApp/iOSApp.swift, iosApp/iosApp/ContentView.swift, iosApp/iosApp/Assets.xcassets/Contents.json, iosApp/iosApp/Assets.xcassets/AccentColor.colorset/Contents.json, iosApp/iosApp/Assets.xcassets/AppIcon.appiconset/Contents.json</files>
  <action>
Create SwiftUI application files:

1. `iosApp/iosApp/iOSApp.swift`:
```swift
import SwiftUI

@main
struct iOSApp: App {
    var body: some Scene {
        WindowGroup {
            ContentView()
        }
    }
}
```

2. `iosApp/iosApp/ContentView.swift`:
```swift
import SwiftUI
import shared

struct ContentView: View {
    var body: some View {
        VStack {
            Text(Greeting().greet())
                .font(.title)
                .padding()
        }
    }
}

#Preview {
    ContentView()
}
```

3. Create Assets.xcassets structure:
   - Contents.json with info metadata
   - AccentColor.colorset with default accent color
   - AppIcon.appiconset with empty icon set (placeholders)

The `import shared` statement imports the Kotlin shared module as a Swift framework.
  </action>
  <verify>File structure is correct and imports are valid</verify>
  <done>SwiftUI app files created with shared module import</done>
</task>

<task type="auto">
  <name>Task 3: Build and verify iOS app with shared framework</name>
  <files>shared/build.gradle.kts</files>
  <action>
Verify iOS build works end-to-end:

1. First, ensure the shared module properly exports the iOS framework:
   - Run `./gradlew :shared:linkDebugFrameworkIosSimulatorArm64` (for Apple Silicon)
   - Or `./gradlew :shared:linkDebugFrameworkIosX64` (for Intel)
   - This generates the framework in shared/build/bin/

2. Update shared/build.gradle.kts if needed to include CocoaPods or SPM configuration:
   - For simple setup, use XCFramework approach
   - Add `ios.framework.baseName = "shared"` if not present

3. Build the iOS app:
   - `xcodebuild -project iosApp/iosApp.xcodeproj -scheme iosApp -destination 'platform=iOS Simulator,name=iPhone 15' build`
   - Or open in Xcode and build manually

4. If framework linking fails:
   - Ensure FRAMEWORK_SEARCH_PATHS includes $(SRCROOT)/../shared/build/xcode-frameworks
   - Ensure the shared framework is embedded and signed properly

Common issues and fixes:
- "No such module 'shared'": Framework not built or not linked
- "Building for iOS, but the linked framework is for iOS Simulator": Architecture mismatch
  </action>
  <verify>xcodebuild build succeeds OR Xcode build succeeds</verify>
  <done>iOS app builds successfully with shared Kotlin framework integrated</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] iosApp Xcode project exists and opens correctly
- [ ] Shared framework is properly linked to iOS target
- [ ] iOS app builds without errors (simulator target)
- [ ] ContentView imports and uses shared module's Greeting class
</verification>

<success_criteria>
- All tasks completed
- iOS app compiles and can be run on iOS Simulator
- SwiftUI ContentView displays "Hello from iOS X.X!" greeting
- KMP shared framework integration proven to work
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
